(()=>{"use strict";var e={265:function(e,t,o){var n,r=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&r(t,e,o[s]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){console.log('Congratulations, your extension "NodeCode" is now active!');const t=i.commands.registerCommand("nodecode.showGraph",(()=>{(0,c.initializeGraphView)(e)}));e.subscriptions.push(t)},t.deactivate=function(){};const i=s(o(398)),c=o(318)},318:function(e,t,o){var n,r=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&r(t,e,o[s]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.initializeGraphView=async function(e){const t=i.window.createWebviewPanel("nodecodeGraphView","NodeCode Graph View",i.ViewColumn.One,{enableScripts:!0,localResourceRoots:[i.Uri.file(c.join(e.extensionPath,"node_modules"))]}),o=t.webview.asWebviewUri(i.Uri.file(c.join(e.extensionPath,"node_modules","cytoscape","dist","cytoscape.min.js")));let n;try{n=await(0,l.buildGraph)(),console.log("Graph data loaded:",n)}catch(e){return console.error("Error building graph:",e),void(t.webview.html=`<h1>Error: ${e.message}</h1>`)}t.webview.html=`\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <script src="${o}"><\/script>\n            <style>#graph-container { width: 100%; height: 100vh; }</style>\n        </head>\n        <body>\n            <div id="graph-container"></div>\n            <script>\n                const vscode = acquireVsCodeApi();\n                const cy = cytoscape({\n                    container: document.getElementById('graph-container'),\n                    elements: ${JSON.stringify([...n.nodes,...n.edges])},\n                    style: [\n                        { selector: 'node', style: { 'background-color': 'blue', 'label': 'data(label)', 'text-valign': 'center', 'color': 'white' } },\n                        { selector: 'edge', style: { 'width': 2, 'line-color': 'gray', 'target-arrow-shape': 'triangle', 'target-arrow-color': 'gray' } }\n                    ],\n                    layout: { name: 'cose' }\n                });\n                cy.ready(() => {\n                    cy.layout({ name: 'cose' }).run(); // Force re-render\n                    vscode.postMessage({ command: 'log', text: 'Graph re-rendered' });\n                    // Log arrow styles for each edge\n                    cy.edges().forEach(edge => {\n                        const arrowShape = edge.style('target-arrow-shape');\n                        const arrowColor = edge.style('target-arrow-color');\n                        vscode.postMessage({ \n                            command: 'log', \n                            text: 'Edge ' + edge.data('source') + ' -> ' + edge.data('target') + ': arrow-shape=' + arrowShape + ', arrow-color=' + arrowColor \n                        });\n                    });\n                });\n                vscode.postMessage({ command: 'log', text: 'Cytoscape edges: ' + JSON.stringify(cy.edges().map(e => e.data())) });\n\n                cy.on('tap', 'node', function(evt) {\n                    const node = evt.target;\n                    const filePath = node.data('id');\n                    vscode.postMessage({ command: 'log', text: 'Node tapped: ' + filePath });\n                    vscode.postMessage({ command: 'openFile', filePath: filePath });\n                });\n\n                cy.on('tap', 'edge', function(evt) {\n                    const edge = evt.target;\n                    const edgeData = {\n                        source: edge.data('source'),\n                        target: edge.data('target'),\n                        importedNames: edge.data('importedNames'),\n                        lineNumber: edge.data('lineNumber')\n                    };\n                    vscode.postMessage({ command: 'log', text: 'Edge tapped: ' + JSON.stringify(edgeData) });\n                    vscode.postMessage({ command: 'showEdgeDetails', edgeData: edgeData });\n                });\n            <\/script>\n        </body>\n        </html>\n    `,t.webview.onDidReceiveMessage((e=>{if(console.log("Received message:",e),"openFile"===e.command){const t=i.Uri.file(e.filePath);i.workspace.openTextDocument(t).then((e=>{i.window.showTextDocument(e)}),(e=>{console.error("Error opening file:",e)}))}else if("showEdgeDetails"===e.command){const{source:t,target:o,importedNames:n,lineNumber:r}=e.edgeData,a=`Edge: ${c.basename(t)} â†’ ${c.basename(o)}\nImported: ${n.join(", ")}\nLine: ${r}`;i.window.showInformationMessage(a)}else"log"===e.command&&console.log(e.text)}),void 0,e.subscriptions)};const i=s(o(398)),c=s(o(928)),l=o(355)},355:function(e,t,o){var n,r=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=n(e),s=0;s<o.length;s++)"default"!==o[s]&&r(t,e,o[s]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.buildGraph=async function(){const e=i.workspace.workspaceFolders?.[0].uri.fsPath;if(!e)throw new Error("No workspace folder found");const t=(await i.workspace.findFiles("**/*.{ts,js}","**/node_modules/**")).map((e=>({fsPath:e.fsPath})));console.log("Discovered files:",t);const o=t.map((e=>({data:{id:e.fsPath,label:c.basename(e.fsPath),type:"file"}}))),n=[],r=new Map;t.forEach((e=>{const t=c.normalize(e.fsPath);r.set(t,e.fsPath);const o=t.replace(/(\.ts|\.js)$/,"");o!==t&&r.set(o,e.fsPath)}));for(const e of t){const t=await l.readFile(e.fsPath,"utf8"),o=t.split("\n");console.log(`File content [${e.fsPath}]:`,t);const a=/import\s*({[^}]+}|\*|\w+)\s*from\s+['"]([^'"]+)['"]/g;let s;for(;null!==(s=a.exec(t));){const t=s,a=t[1].trim(),i=t[2],l=o.findIndex((e=>e.includes(t[0])))+1,d="*"===a?["*"]:a.replace(/[{}]/g,"").split(",").map((e=>e.trim())),u=c.normalize(c.resolve(c.dirname(e.fsPath),i));let f=r.get(u);if(!f)for(const e of[".ts",".js"]){const t=u+e;if(f=r.get(t),f){console.log(`Resolved ${i} to ${t}`);break}}if(f&&e.fsPath!==f){const t={data:{source:e.fsPath,target:f,type:"import",importedNames:d,lineNumber:l}};console.log(`Edge created: ${c.basename(e.fsPath)} -> ${c.basename(f)}`),n.push(t)}else console.log(`No valid target for import: ${i} in ${e.fsPath}, resolved to: ${u}`)}}return console.log("Edges:",n),{nodes:o,edges:n}};const i=s(o(398)),c=s(o(928)),l=s(o(943))},398:e=>{e.exports=require("vscode")},928:e=>{e.exports=require("path")},943:e=>{e.exports=require("fs/promises")}},t={},o=function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,o),a.exports}(265);module.exports=o})();